.PHONY: util/depclean util/all util/clean

util/all: $(MAKEDEFS) $(RECOVER) $(DGN_COMP) $(LEV_COMP)

util/depclean:
	$(RM) $(MAKEDEFS_DEPS) $(MAKEDEFS) $(MAKEDEFS_OBJECTS) $(RECOVER_DEPS) $(ALLOC_DEPS) $(DGN_COMP_DEPS) $(DGN_YACC_DEPS) $(DGN_LEX_DEPS) $(DGN_LEX_GENERATED_SOURCES) $(DGN_YACC_GENERATED_SOURCES) $(LEV_YACC_GENERATED_SOURCES) $(LEV_LEX_GENERATED_SOURCES) $(LEV_COMP_DEPS) $(LEV_YACC_DEPS) $(LEV_LEX_DEPS) $(INCDIR)/lev_comp.h $(INCDIR)/dgl_comp.h

util/clean:
	$(RM) $(RECOVER) $(RECOVER_OBJECTS) $(ALLOC_OBJECTS) $(DGN_COMP) $(DGN_COMP_OBJECTS) $(DGN_YACC_OBJECTS) $(DGN_LEX_OBJECTS) $(LEV_YACC_OBJECTS) $(LEV_LEX_OBJECTS) $(LEV_COMP) $(LEV_COMP_OBJECTS)

$(MAKEDEFS): $(MAKEDEFS_OBJECTS) $(MONOBJ_OBJECTS)
$(MAKEDEFS): EXE_OBJECTS := $(MAKEDEFS_OBJECTS) $(MONOBJ_OBJECTS)

$(RECOVER): $(RECOVER_OBJECTS)
$(RECOVER): EXE_OBJECTS := $(RECOVER_OBJECTS)

$(DGN_COMP): $(DGN_COMP_OBJECTS) $(ALLOC_OBJECTS) $(DGN_YACC_OBJECTS) $(DGN_LEX_OBJECTS)
$(DGN_COMP): EXE_OBJECTS := $(DGN_COMP_OBJECTS) $(ALLOC_OBJECTS) $(DGN_YACC_OBJECTS) $(DGN_LEX_OBJECTS)

$(LEV_COMP): $(LEV_COMP_OBJECTS) $(LEV_LEX_OBJECTS) $(LEV_YACC_OBJECTS) $(NAMING_OBJECTS) $(ALLOC_OBJECTS) $(MONOBJ_OBJECTS)
$(LEV_COMP): EXE_OBJECTS := $(LEV_COMP_OBJECTS) $(LEV_LEX_OBJECTS) $(LEV_YACC_OBJECTS) $(NAMING_OBJECTS) $(ALLOC_OBJECTS) $(MONOBJ_OBJECTS)

$(MAKEDEFS_OBJECTS): $(MAKEDEFS_SOURCES)
$(RECOVER_OBJECTS): $(RECOVER_SOURCES)
$(DGN_COMP_OBJECTS): $(DGN_COMP_SOURCES)
$(LEV_COMP_OBJECTS): $(LEV_COMP_SOURCES)

$(ALLOC_OBJECTS): $(ALLOC_SOURCES)

$(DGN_YACC_GENERATED_SOURCES): $(DGN_YACC_SOURCES)
$(DGN_YACC_OBJECTS): $(DGN_YACC_GENERATED_SOURCES)

$(DGN_LEX_GENERATED_SOURCES): $(DGN_LEX_SOURCES)
$(DGN_LEX_DEPS): $(INCDIR)/dgn_comp.h
$(DGN_LEX_OBJECTS): $(DGN_LEX_GENERATED_SOURCES) $(INCDIR)/dgn_comp.h

$(LEV_YACC_GENERATED_SOURCES): $(LEV_YACC_SOURCES)
$(LEV_YACC_OBJECTS): $(LEV_YACC_GENERATED_SOURCES)

$(LEV_LEX_GENERATED_SOURCES): $(LEV_LEX_SOURCES)
$(LEV_LEX_DEPS): $(INCDIR)/lev_comp.h
$(LEV_LEX_OBJECTS): $(LEV_LEX_GENERATED_SOURCES) $(INCDIR)/lev_comp.h

-include $(MAKEDEFS_DEPS) $(RECOVER_DEPS) $(ALLOC_DEPS) $(DGN_COMP_DEPS) $(DGN_YACC_DEPS) $(DGN_LEX_DEPS) $(LEV_YACC_DEPS) $(LEV_LEX_DEPS) $(LEV_COMP_DEPS)

$(DGN_LEX_DEPS) $(LEV_LEX_DEPS) $(LEV_COMP_DEPS) $(DGN_YACC_DEPS): $(INCLUDE_GENERATED_HEADERS)

$(DGN_LEX_GENERATED_SOURCES) $(LEV_LEX_GENERATED_SOURCES): %.c: %.l
	$(LEX) $(LEXFLAGS) --outfile=$@ $<

$(CURDIR)/%_yacc.c $(INCDIR)/%_comp.h: CURDIR := $(CURDIR)
$(CURDIR)/%_yacc.c $(INCDIR)/%_comp.h: $(CURDIR)/%_yacc.y
	$(YACC) $(YACCFLAGS) --output-file=$(CURDIR)/$*_yacc.c --defines=$(INCDIR)/$*_comp.h -d $<
